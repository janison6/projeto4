trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

variables:
  dockerVersion: '20.10.24' # Ou a versão que você preferir

steps:
- task: DockerInstaller@0
  displayName: 'Install Docker'
  inputs:
    dockerVersion: '$(dockerVersion)'

- script: |
    docker login -u $(dockerHubUsername) -p $(dockerHubPassword)  # Adicione esta linha!
    docker build -f /home/vsts/work/1/s/Dockerfile \
      --label com.azure.dev.image.system.teamfoundationcollectionuri=https://dev.azure.com/janison6/ \
      --label com.azure.dev.image.system.teamproject=Unyleya_Projeto_DevOps \
      --label com.azure.dev.image.build.repository.name=janison6/projeto4 \
      --label com.azure.dev.image.build.sourceversion=e43fd29988724edb63e614d6da4996ec667583f1 \
      --label com.azure.dev.image.build.repository.uri=https://github.com/janison6/projeto4 \
      --label com.azure.dev.image.build.sourcebranchname=main \
      --label com.azure.dev.image.build.definitionname=janison6.projeto4 \
      --label com.azure.dev.image.build.buildnumber=20250131.3 \
      --label com.azure.dev.image.build.builduri=vstfs:///Build/Build/155 \
      --label image.base.ref.name=ubuntu:latest \
      --label image.base.digest=sha256:80dd3c3b9c6cecb9f1667e9290b3bc61b78c2678c02cbdae5f0fea92cc6734ab \
      -t "$(dockerHubUsername)/$(imageName):$(Build.BuildId)" /home/vsts/work/1/s
    docker push "$(dockerHubUsername)/$(imageName):$(Build.BuildId)" # Adicione esta linha para o push
    echo "Imagem a ser construída: $(dockerHubUsername)/$(imageName):$(Build.BuildId)" # Linha de debug
  displayName: 'Build and push image to Docker Hub'
